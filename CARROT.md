당근
------

**당근의 탄생**
 * 당근은 Frogpilot + Apilot을 섞어서 만들었다.
 * Frogpilot의 거의 모든기능을 사용할 수 있고, 설정을 기본으로 바꿔주면 당근의 기능을 사용할 수 있다.

**당근의 특별한기능**
 * Frogpilot의 모든기능
 * SCC배선개조, 레이더트랙지원
 * 신호정지/출발기능
 * 다양한 주행모드(일반/연비/안전/고속)
 * 소프트오토홀드기능
 * 멋진 당근UI
 * 자동크루즈ON/OFF제어
 * 연비속도제어
 * 당근맨(스마트폰앱)지원: 네비연결,설정, 유지보수,음성지원
 * NOO Helper기능 : 자동차선변경 및 속도제어 지원
 * 차선추적기능(LaneMode): 차선이 1개만 있어도 차선을 따라감.

**지원차량**
 * 오파가 지원하는 차량들은 당근 모두 지원해야하지만 혼자만의 한계로 테스트가 힘들어서 내차 SantaFe HEV 2022위주로만 시험한다.
 * 현기차는 배선종류만 많을뿐 통신구조는 거의 같아 거의 대부분 적용이 된다.
 * 현기차의 최근 CANFD차량은 시험해보지 않았다.
 * GM의 경우  종류가 너무많아서 모른다.
 * 토요타외에 몇몇차량은 지원되는듯하다.

**현기차 지원대상(CANFD제외)**
 * 순정차량
   * 순정차량은 순정의 크루즈제어(롱컨)를 이용하고, 조향만 오파가 제어한다.
   * 물론, 오파가 속도제어는 어느정도 해준다.
 * SCC배선개조차량 (Bus2만지원됨)
   * 거의 대부분의 차량은 SCC모듈(레이더모듈)에서 차량주행제어(크루즈, 롱컨, longcontrol)를 한다.
   * SCC모듈은 기본적으로 자동차를 제어하기 위한 C-CAN에 연결되어 있다. 오파가 차량의 롱컨을 제어하기 위해서는 SCC모듈에서 나오는 차량제어코드(SCCxx등)를 변조하면된다.
   * SCC코드를 변조하기 위해, SCC모듈의 캔선을 잘라내어 오파 판다의 BUS2에 물려주면 된다.
   * 일부차량은 LKAS모듈에서 SCC제어를 하기 때문에 개조가 필요없다.
 * MDPS 배선 개조차량(지원안됨)
   * SMDPS개조된것만 지원됨
     * SMDPS란 Smart MDPS라고 sunnypilot에서 만든 용어이다.
     * 저속에서 조향이 안되는 구형차량을 위해 만든개조방식이다.
     * MDPS배선중간에 WhitePanda를 연결하여 캔데이터를 조작하여 마치 빨리달리는 차량인것 처럼 속여주는것이다.

설치
------
 * 당근파일럿은 직접설치가 안된다.  반드시, ssh연결을 하여 clone하여 빌드하여 설치해야한다.
**ssh의 연결**
 * ssh key만들기 (PEM옵션넣어야함)
 * ssh key의 등록 (github에 등록함)
 * 오파의 설정
   * 네트워크 - 고급설정 - SSH 사용 : ON
   * 네트워크 - 고급설정 - SSH키 : 추가  (자신의 id를 입력)
 * 연결하기
   * MobaXterm의 설치 및 ssh설정

**소스받아오기(clone하기)**
 * ssh로그인
 * 기존것 삭제
   * cd /data
   * mv openpilot openpilot_bak
 * 데이터받기
   * git clone -b master https://github.com/ajouatom/carrotpilot openpilot

**빌드**
 * cd /data
 * ./restart.py

**빌드확인**
 * tmux a

초기세팅
------
 * 언어설정
 * 차량선택
 * 당근기본값으로 설정: 장치(Device) -> Set to default(for HKG)
 * 차량에 맞게 설정
   * 순정차량
   * 롱컨지원차량

수정이력
------
 * 240114
   * liveSR삭제
     * 당근메뉴: Tuning -> LAT:SteerRatio 값을 설정하거나,
     * 개구리메뉴: Lateral Tuning -> Manager -> SteerRatio를 설정하거나,
     * 당근맨:  SET -> 조향튜닝 -> SteerRatioCustom값을 설정함.
   * pcmCruise지원(현기차)
     * 롱컨 비개조차량지원 및 시험.

